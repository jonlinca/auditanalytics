<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Import data | Audit Analytics with R</title>
  <meta name="description" content="A toolkit for Internal Audit and Financial auditors" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Import data | Audit Analytics with R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://auditanalytics.jonlin.ca/" />
  
  <meta property="og:description" content="A toolkit for Internal Audit and Financial auditors" />
  <meta name="github-repo" content="jonlinca/auditanalytics" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Import data | Audit Analytics with R" />
  
  <meta name="twitter:description" content="A toolkit for Internal Audit and Financial auditors" />
  

<meta name="author" content="Jonathan Lin" />


<meta name="date" content="2020-11-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="setup.html"/>
<link rel="next" href="data-completeness.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<script src="libs/d3-3.3.8/d3.min.js"></script>
<script src="libs/dagre-0.4.0/dagre-d3.min.js"></script>
<link href="libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet" />
<script src="libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script>
<script src="libs/chromatography-0.1/chromatography.js"></script>
<script src="libs/DiagrammeR-binding-1.0.6.1/DiagrammeR.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.14/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Audit Analytics in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the author</a><ul>
<li class="chapter" data-level="0.1" data-path="about-the-author.html"><a href="about-the-author.html#acknowledgements"><i class="fa fa-check"></i><b>0.1</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="part"><span><b>I Structure</b></span></li>
<li class="chapter" data-level="2" data-path="approach.html"><a href="approach.html"><i class="fa fa-check"></i><b>2</b> Approach</a><ul>
<li class="chapter" data-level="2.1" data-path="approach.html"><a href="approach.html#code-based-development"><i class="fa fa-check"></i><b>2.1</b> Code-based development</a></li>
<li class="chapter" data-level="2.2" data-path="approach.html"><a href="approach.html#automate-relentlessly"><i class="fa fa-check"></i><b>2.2</b> Automate relentlessly</a></li>
<li class="chapter" data-level="2.3" data-path="approach.html"><a href="approach.html#share-everything"><i class="fa fa-check"></i><b>2.3</b> Share everything</a></li>
<li class="chapter" data-level="2.4" data-path="approach.html"><a href="approach.html#always-deliver-useful-product"><i class="fa fa-check"></i><b>2.4</b> Always deliver useful product</a></li>
<li class="chapter" data-level="2.5" data-path="approach.html"><a href="approach.html#dont-be-a-hero"><i class="fa fa-check"></i><b>2.5</b> Don’t be a hero</a></li>
<li class="chapter" data-level="2.6" data-path="approach.html"><a href="approach.html#the-opportunity-cost"><i class="fa fa-check"></i><b>2.6</b> “The opportunity cost”</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="architecture.html"><a href="architecture.html"><i class="fa fa-check"></i><b>3</b> Architecture</a><ul>
<li class="chapter" data-level="3.1" data-path="architecture.html"><a href="architecture.html#architecture-r"><i class="fa fa-check"></i><b>3.1</b> R and RStudio</a></li>
<li class="chapter" data-level="3.2" data-path="architecture.html"><a href="architecture.html#code-repositories"><i class="fa fa-check"></i><b>3.2</b> Code repositories</a><ul>
<li class="chapter" data-level="3.2.1" data-path="architecture.html"><a href="architecture.html#git"><i class="fa fa-check"></i><b>3.2.1</b> git</a></li>
<li class="chapter" data-level="3.2.2" data-path="architecture.html"><a href="architecture.html#packages"><i class="fa fa-check"></i><b>3.2.2</b> Packages</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="architecture.html"><a href="architecture.html#data-products"><i class="fa fa-check"></i><b>3.3</b> Data products</a><ul>
<li class="chapter" data-level="3.3.1" data-path="architecture.html"><a href="architecture.html#galvanize-highbond"><i class="fa fa-check"></i><b>3.3.1</b> Galvanize Highbond</a></li>
<li class="chapter" data-level="3.3.2" data-path="architecture.html"><a href="architecture.html#architecture-rsc"><i class="fa fa-check"></i><b>3.3.2</b> RStudio Connect</a></li>
<li class="chapter" data-level="3.3.3" data-path="architecture.html"><a href="architecture.html#rstudio-package-manager"><i class="fa fa-check"></i><b>3.3.3</b> RStudio Package Manager</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="architecture.html"><a href="architecture.html#data-sources"><i class="fa fa-check"></i><b>3.4</b> Data sources</a><ul>
<li class="chapter" data-level="3.4.1" data-path="architecture.html"><a href="architecture.html#internal-databases"><i class="fa fa-check"></i><b>3.4.1</b> Internal databases</a></li>
<li class="chapter" data-level="3.4.2" data-path="architecture.html"><a href="architecture.html#external-sources"><i class="fa fa-check"></i><b>3.4.2</b> External sources</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="architecture.html"><a href="architecture.html#audit-data-mart"><i class="fa fa-check"></i><b>3.5</b> Audit data mart</a></li>
</ul></li>
<li class="part"><span><b>II Technical</b></span></li>
<li class="chapter" data-level="4" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>4</b> Setup</a><ul>
<li class="chapter" data-level="4.1" data-path="setup.html"><a href="setup.html#setup-r"><i class="fa fa-check"></i><b>4.1</b> R with RStudio</a></li>
<li class="chapter" data-level="4.2" data-path="setup.html"><a href="setup.html#common-packages"><i class="fa fa-check"></i><b>4.2</b> Common packages</a></li>
<li class="chapter" data-level="4.3" data-path="setup.html"><a href="setup.html#highbond-r-package."><i class="fa fa-check"></i><b>4.3</b> Highbond R package.</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="import-data.html"><a href="import-data.html"><i class="fa fa-check"></i><b>5</b> Import data</a><ul>
<li class="chapter" data-level="5.1" data-path="import-data.html"><a href="import-data.html#delimited-files"><i class="fa fa-check"></i><b>5.1</b> Delimited files</a><ul>
<li class="chapter" data-level="5.1.1" data-path="import-data.html"><a href="import-data.html#handling-problematic-delimited-files"><i class="fa fa-check"></i><b>5.1.1</b> Handling problematic delimited files</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="import-data.html"><a href="import-data.html#import-db"><i class="fa fa-check"></i><b>5.2</b> Databases</a></li>
<li class="chapter" data-level="5.3" data-path="import-data.html"><a href="import-data.html#apis"><i class="fa fa-check"></i><b>5.3</b> APIs</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-completeness.html"><a href="data-completeness.html"><i class="fa fa-check"></i><b>6</b> Data Completeness</a><ul>
<li class="chapter" data-level="6.1" data-path="data-completeness.html"><a href="data-completeness.html#exploration-of-general-ledger-data"><i class="fa fa-check"></i><b>6.1</b> Exploration of General Ledger data</a></li>
<li class="chapter" data-level="6.2" data-path="data-completeness.html"><a href="data-completeness.html#examination-of-potential-errors"><i class="fa fa-check"></i><b>6.2</b> Examination of potential errors</a><ul>
<li class="chapter" data-level="6.2.1" data-path="data-completeness.html"><a href="data-completeness.html#completeness-na"><i class="fa fa-check"></i><b>6.2.1</b> NA values</a></li>
<li class="chapter" data-level="6.2.2" data-path="data-completeness.html"><a href="data-completeness.html#journal-entries-balance-to-zero"><i class="fa fa-check"></i><b>6.2.2</b> Journal Entries balance to zero</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="data-completeness.html"><a href="data-completeness.html#transforming-of-trial-balance-data"><i class="fa fa-check"></i><b>6.3</b> Transforming of Trial Balance data</a><ul>
<li class="chapter" data-level="6.3.1" data-path="data-completeness.html"><a href="data-completeness.html#sum-by-absolute-references"><i class="fa fa-check"></i><b>6.3.1</b> Sum by absolute references</a></li>
<li class="chapter" data-level="6.3.2" data-path="data-completeness.html"><a href="data-completeness.html#sum-by-numeric-position"><i class="fa fa-check"></i><b>6.3.2</b> Sum by numeric position</a></li>
<li class="chapter" data-level="6.3.3" data-path="data-completeness.html"><a href="data-completeness.html#sum-by-named-references"><i class="fa fa-check"></i><b>6.3.3</b> Sum by named references</a></li>
<li class="chapter" data-level="6.3.4" data-path="data-completeness.html"><a href="data-completeness.html#pivot-then-summarize"><i class="fa fa-check"></i><b>6.3.4</b> Pivot then summarize</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="data-completeness.html"><a href="data-completeness.html#asserting-completeness"><i class="fa fa-check"></i><b>6.4</b> Asserting Completeness</a><ul>
<li class="chapter" data-level="6.4.1" data-path="data-completeness.html"><a href="data-completeness.html#completeness-join"><i class="fa fa-check"></i><b>6.4.1</b> Joining the GL to the TB</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="data-completeness.html"><a href="data-completeness.html#cautionary-notes-for-completeness"><i class="fa fa-check"></i><b>6.5</b> Cautionary notes for Completeness</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="cleaning-data.html"><a href="cleaning-data.html"><i class="fa fa-check"></i><b>7</b> Cleaning data</a><ul>
<li class="chapter" data-level="7.1" data-path="cleaning-data.html"><a href="cleaning-data.html#basic-math"><i class="fa fa-check"></i><b>7.1</b> Basic math</a></li>
<li class="chapter" data-level="7.2" data-path="cleaning-data.html"><a href="cleaning-data.html#dates-and-times"><i class="fa fa-check"></i><b>7.2</b> Dates and Times</a><ul>
<li class="chapter" data-level="7.2.1" data-path="cleaning-data.html"><a href="cleaning-data.html#understanding-default-time-zones"><i class="fa fa-check"></i><b>7.2.1</b> Understanding Default Time Zones</a></li>
<li class="chapter" data-level="7.2.2" data-path="cleaning-data.html"><a href="cleaning-data.html#override-or-display-timezones"><i class="fa fa-check"></i><b>7.2.2</b> Override or display timezones</a></li>
<li class="chapter" data-level="7.2.3" data-path="cleaning-data.html"><a href="cleaning-data.html#daylight-saving-implications"><i class="fa fa-check"></i><b>7.2.3</b> Daylight Saving Implications</a></li>
<li class="chapter" data-level="7.2.4" data-path="cleaning-data.html"><a href="cleaning-data.html#differences-between-time"><i class="fa fa-check"></i><b>7.2.4</b> Differences between time</a></li>
<li class="chapter" data-level="7.2.5" data-path="cleaning-data.html"><a href="cleaning-data.html#derived-date-information"><i class="fa fa-check"></i><b>7.2.5</b> Derived date information</a></li>
<li class="chapter" data-level="7.2.6" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-numerical-dates"><i class="fa fa-check"></i><b>7.2.6</b> Cleaning numerical dates</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="cleaning-data.html"><a href="cleaning-data.html#separate"><i class="fa fa-check"></i><b>7.3</b> Separate</a></li>
<li class="chapter" data-level="7.4" data-path="cleaning-data.html"><a href="cleaning-data.html#separate_rows"><i class="fa fa-check"></i><b>7.4</b> Separate_rows</a></li>
<li class="chapter" data-level="7.5" data-path="cleaning-data.html"><a href="cleaning-data.html#tidy-data"><i class="fa fa-check"></i><b>7.5</b> Tidy data</a></li>
<li class="chapter" data-level="7.6" data-path="cleaning-data.html"><a href="cleaning-data.html#clean-pivot"><i class="fa fa-check"></i><b>7.6</b> Pivots, wide and longer</a></li>
<li class="chapter" data-level="7.7" data-path="cleaning-data.html"><a href="cleaning-data.html#joining-data"><i class="fa fa-check"></i><b>7.7</b> Joining data</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exploring-data.html"><a href="exploring-data.html"><i class="fa fa-check"></i><b>8</b> Exploring data</a><ul>
<li class="chapter" data-level="8.1" data-path="exploring-data.html"><a href="exploring-data.html#explore-stats"><i class="fa fa-check"></i><b>8.1</b> Basic Statistics</a></li>
<li class="chapter" data-level="8.2" data-path="exploring-data.html"><a href="exploring-data.html#summarizations"><i class="fa fa-check"></i><b>8.2</b> Summarizations</a></li>
<li class="chapter" data-level="8.3" data-path="exploring-data.html"><a href="exploring-data.html#data-visualization---why"><i class="fa fa-check"></i><b>8.3</b> Data Visualization - Why</a></li>
<li class="chapter" data-level="8.4" data-path="exploring-data.html"><a href="exploring-data.html#data-visualization---how"><i class="fa fa-check"></i><b>8.4</b> Data Visualization - How</a><ul>
<li class="chapter" data-level="8.4.1" data-path="exploring-data.html"><a href="exploring-data.html#time-series"><i class="fa fa-check"></i><b>8.4.1</b> Time-series</a></li>
<li class="chapter" data-level="8.4.2" data-path="exploring-data.html"><a href="exploring-data.html#facets"><i class="fa fa-check"></i><b>8.4.2</b> Facets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="test.html"><a href="test.html"><i class="fa fa-check"></i><b>9</b> Test</a><ul>
<li class="chapter" data-level="9.1" data-path="test.html"><a href="test.html#amount-based-tests"><i class="fa fa-check"></i><b>9.1</b> Amount-based tests</a><ul>
<li class="chapter" data-level="9.1.1" data-path="test.html"><a href="test.html#above-te"><i class="fa fa-check"></i><b>9.1.1</b> Above threshold</a></li>
<li class="chapter" data-level="9.1.2" data-path="test.html"><a href="test.html#round-numbers"><i class="fa fa-check"></i><b>9.1.2</b> Round numbers</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="test.html"><a href="test.html#date-based-tests"><i class="fa fa-check"></i><b>9.2</b> Date-based tests</a><ul>
<li class="chapter" data-level="9.2.1" data-path="test.html"><a href="test.html#weekend-testing"><i class="fa fa-check"></i><b>9.2.1</b> Weekend testing</a></li>
<li class="chapter" data-level="9.2.2" data-path="test.html"><a href="test.html#cutoff-testing"><i class="fa fa-check"></i><b>9.2.2</b> Cutoff testing</a></li>
<li class="chapter" data-level="9.2.3" data-path="test.html"><a href="test.html#age"><i class="fa fa-check"></i><b>9.2.3</b> Age</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="test.html"><a href="test.html#basic-statistical-tests"><i class="fa fa-check"></i><b>9.3</b> Basic Statistical tests</a><ul>
<li class="chapter" data-level="9.3.1" data-path="test.html"><a href="test.html#outliers-based-on-amount"><i class="fa fa-check"></i><b>9.3.1</b> Outliers based on amount</a></li>
<li class="chapter" data-level="9.3.2" data-path="test.html"><a href="test.html#outliers-based-on-amounts-and-other-factors"><i class="fa fa-check"></i><b>9.3.2</b> Outliers based on amounts and other factors</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="test.html"><a href="test.html#unusual-pattern-and-behaviours"><i class="fa fa-check"></i><b>9.4</b> Unusual pattern and behaviours</a><ul>
<li class="chapter" data-level="9.4.1" data-path="test.html"><a href="test.html#benfords-law-analysis"><i class="fa fa-check"></i><b>9.4.1</b> Benford’s Law analysis</a></li>
<li class="chapter" data-level="9.4.2" data-path="test.html"><a href="test.html#relative-size-factor-rsf"><i class="fa fa-check"></i><b>9.4.2</b> Relative size factor (RSF)</a></li>
<li class="chapter" data-level="9.4.3" data-path="test.html"><a href="test.html#duplicate-invoices"><i class="fa fa-check"></i><b>9.4.3</b> Duplicate Invoices</a></li>
<li class="chapter" data-level="9.4.4" data-path="test.html"><a href="test.html#detecting-gaps-in-sequences"><i class="fa fa-check"></i><b>9.4.4</b> Detecting gaps in sequences</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="test.html"><a href="test.html#test-searchtext"><i class="fa fa-check"></i><b>9.5</b> Search text</a><ul>
<li class="chapter" data-level="9.5.1" data-path="test.html"><a href="test.html#regex-basics"><i class="fa fa-check"></i><b>9.5.1</b> Regex basics</a></li>
<li class="chapter" data-level="9.5.2" data-path="test.html"><a href="test.html#starts-or-ends-with-anchors"><i class="fa fa-check"></i><b>9.5.2</b> Starts or Ends with (Anchors)</a></li>
<li class="chapter" data-level="9.5.3" data-path="test.html"><a href="test.html#crash-course-in-encoding"><i class="fa fa-check"></i><b>9.5.3</b> Crash course in Encoding</a></li>
<li class="chapter" data-level="9.5.4" data-path="test.html"><a href="test.html#cleaning-text"><i class="fa fa-check"></i><b>9.5.4</b> Cleaning Text</a></li>
<li class="chapter" data-level="9.5.5" data-path="test.html"><a href="test.html#searching-multiple-fields"><i class="fa fa-check"></i><b>9.5.5</b> Searching Multiple Fields</a></li>
<li class="chapter" data-level="9.5.6" data-path="test.html"><a href="test.html#regex-further"><i class="fa fa-check"></i><b>9.5.6</b> Further reading</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="report.html"><a href="report.html"><i class="fa fa-check"></i><b>10</b> Report</a><ul>
<li class="chapter" data-level="10.1" data-path="report.html"><a href="report.html#report-structure"><i class="fa fa-check"></i><b>10.1</b> Report Structure</a></li>
<li class="chapter" data-level="10.2" data-path="report.html"><a href="report.html#export-files"><i class="fa fa-check"></i><b>10.2</b> Export files</a></li>
</ul></li>
<li class="part"><span><b>III Advanced teams</b></span></li>
<li class="chapter" data-level="11" data-path="applied-audit-analytics.html"><a href="applied-audit-analytics.html"><i class="fa fa-check"></i><b>11</b> Applied Audit Analytics</a></li>
<li class="chapter" data-level="12" data-path="auditpackage.html"><a href="auditpackage.html"><i class="fa fa-check"></i><b>12</b> Audit R Package</a><ul>
<li class="chapter" data-level="12.1" data-path="auditpackage.html"><a href="auditpackage.html#package-functions"><i class="fa fa-check"></i><b>12.1</b> Package functions</a></li>
<li class="chapter" data-level="12.2" data-path="auditpackage.html"><a href="auditpackage.html#templates"><i class="fa fa-check"></i><b>12.2</b> Templates</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html"><i class="fa fa-check"></i><b>13</b> Continuous monitoring</a><ul>
<li class="chapter" data-level="13.1" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html#considerations"><i class="fa fa-check"></i><b>13.1</b> Considerations</a></li>
<li class="chapter" data-level="13.2" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html#create-a-collection-analytic-and-table"><i class="fa fa-check"></i><b>13.2</b> Create a Collection, Analytic and Table</a></li>
<li class="chapter" data-level="13.3" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html#define-the-high-risk-test"><i class="fa fa-check"></i><b>13.3</b> Define the High Risk test</a></li>
<li class="chapter" data-level="13.4" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html#uploading-additional-results"><i class="fa fa-check"></i><b>13.4</b> Uploading additional results</a></li>
<li class="chapter" data-level="13.5" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html#downloading-records-and-responses"><i class="fa fa-check"></i><b>13.5</b> Downloading records and responses</a></li>
<li class="chapter" data-level="13.6" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html#triggers-and-questionnaires"><i class="fa fa-check"></i><b>13.6</b> Triggers and Questionnaires</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="applied-datamart.html"><a href="applied-datamart.html"><i class="fa fa-check"></i><b>14</b> Audit Data Mart</a><ul>
<li class="chapter" data-level="14.1" data-path="applied-datamart.html"><a href="applied-datamart.html#what-to-etl"><i class="fa fa-check"></i><b>14.1</b> What to ETL</a></li>
<li class="chapter" data-level="14.2" data-path="applied-datamart.html"><a href="applied-datamart.html#etl-essentials"><i class="fa fa-check"></i><b>14.2</b> ETL Essentials</a></li>
<li class="chapter" data-level="14.3" data-path="applied-datamart.html"><a href="applied-datamart.html#etl-example"><i class="fa fa-check"></i><b>14.3</b> ETL Example</a></li>
</ul></li>
<li class="part"><span><b>IV Appendix</b></span></li>
<li class="chapter" data-level="15" data-path="appendixct.html"><a href="appendixct.html"><i class="fa fa-check"></i><b>15</b> Continuous Auditing methodology</a><ul>
<li class="chapter" data-level="15.1" data-path="appendixct.html"><a href="appendixct.html#support-for-continuous-auditing"><i class="fa fa-check"></i><b>15.1</b> Support for Continuous Auditing</a></li>
<li class="chapter" data-level="15.2" data-path="appendixct.html"><a href="appendixct.html#the-requirements-for-evaluting-icfr"><i class="fa fa-check"></i><b>15.2</b> The requirements for evaluting ICFR</a></li>
<li class="chapter" data-level="15.3" data-path="appendixct.html"><a href="appendixct.html#determining-population-tolerable-error-rate"><i class="fa fa-check"></i><b>15.3</b> Determining population tolerable error rate</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="other-practices-to-follow.html"><a href="other-practices-to-follow.html"><i class="fa fa-check"></i><b>16</b> Other practices to follow</a><ul>
<li class="chapter" data-level="16.1" data-path="other-practices-to-follow.html"><a href="other-practices-to-follow.html#documentation"><i class="fa fa-check"></i><b>16.1</b> Documentation</a></li>
<li class="chapter" data-level="16.2" data-path="other-practices-to-follow.html"><a href="other-practices-to-follow.html#passwords"><i class="fa fa-check"></i><b>16.2</b> Passwords</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Audit Analytics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="import-data" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Import data</h1>
<p>In this chapter, we will download some datasets and import them. You will need the following packages to follow along.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="import-data.html#cb3-1"></a><span class="kw">library</span>(dplyr) <span class="co"># For manipulating data</span></span>
<span id="cb3-2"><a href="import-data.html#cb3-2"></a></span>
<span id="cb3-3"><a href="import-data.html#cb3-3"></a><span class="kw">library</span>(readr) <span class="co"># For reading flat files</span></span>
<span id="cb3-4"><a href="import-data.html#cb3-4"></a></span>
<span id="cb3-5"><a href="import-data.html#cb3-5"></a><span class="kw">library</span>(DBI) <span class="co"># For database connections</span></span>
<span id="cb3-6"><a href="import-data.html#cb3-6"></a></span>
<span id="cb3-7"><a href="import-data.html#cb3-7"></a><span class="co"># For API connections</span></span>
<span id="cb3-8"><a href="import-data.html#cb3-8"></a><span class="kw">library</span>(httr)</span>
<span id="cb3-9"><a href="import-data.html#cb3-9"></a><span class="kw">library</span>(jsonlite)</span></code></pre></div>
<div id="delimited-files" class="section level2">
<h2><span class="header-section-number">5.1</span> Delimited files</h2>
<p>The most common method of obtaining data is via flat files, usually in the form of comma separated files (CSV). While delimited data sources are the most convenient for data sources where direct data connections are otherwise unobtainable, they are not set up for long term sustainability and automation.</p>
<p>The base package, installed with all instances of R, and <code>read.table()</code> is a convenient built-in standard function for importing CSV files. Another package, <a href="https://readr.tidyverse.org">readr</a>, includes a similar function called <code>read_delim()</code>, which is faster and allows for easy altering of column specifications, which directs the data types each column is imported as (for example, overriding an employee’s identification number as a character versus a numeric).</p>
<p>Before importing the file, lets download the file from the repository that contains the Vendor Master. This dataset contains the vendor system ID number, the date it was added, and other traits.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="import-data.html#cb4-1"></a><span class="kw">dir.create</span>(<span class="st">&quot;data&quot;</span>, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>) <span class="co"># Creates a directory in your project</span></span>
<span id="cb4-2"><a href="import-data.html#cb4-2"></a><span class="kw">download.file</span>(<span class="dt">url =</span> <span class="st">&quot;https://github.com/jonlinca/auditanalytics/raw/master/data/vendor_master.csv&quot;</span>,</span>
<span id="cb4-3"><a href="import-data.html#cb4-3"></a>              <span class="dt">destfile =</span> <span class="st">&quot;data/vendor_master.csv&quot;</span>, <span class="dt">mode =</span> <span class="st">&quot;wb&quot;</span>) <span class="co"># Downloads this csv file into the data folder</span></span></code></pre></div>
<p>When importing delimited files, there will always be a few aspects to consider. The <em>delimiter</em> is the character that separates each field - most common delimiters are commas (,), pipes (|) and tab separators. Using an uncommon character was a typical workaround when exporting data from legacy systems, as commas within text fields were incorrectly parsed as extra columns. If possible, <em>qualifiers</em> should be used to enclose text with a field, typically quotes or double quotes. This will indicate to the system that everything within those quotes belongs to a specific field.</p>
<p>In this case, if you view the file (on the Files panel on the right, go to the data folder, click on vendor_master.csv, and select View File), you will see the data is separated by commas.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="import-data.html#cb5-1"></a>raw_vendors &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="st">&#39;data/vendor_master.csv&#39;</span>, <span class="dt">delim =</span> <span class="st">&quot;,&quot;</span>)</span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   id = col_double(),
##   type = col_character(),
##   name = col_character(),
##   date_added = col_date(format = &quot;&quot;),
##   summary = col_character(),
##   `2015` = col_double(),
##   `2016` = col_double(),
##   `2017` = col_double(),
##   `2018` = col_double()
## )</code></pre>
<p>The message indicates that default column types were assigned to each field imported. If all the fields imported as expected, this message can be ignored.</p>
<p>However, ID numbers, while presented as a number, don’t have a real value in any calculations. As a result, you can specify a column specification via the <code>col_types</code> argument, copy and pasting the framework in the message and changing the fields as need be:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="import-data.html#cb7-1"></a>cols &lt;-<span class="st"> </span><span class="kw">cols</span>(</span>
<span id="cb7-2"><a href="import-data.html#cb7-2"></a>  <span class="dt">id =</span> <span class="kw">col_character</span>(), <span class="co"># Changed from col_double()</span></span>
<span id="cb7-3"><a href="import-data.html#cb7-3"></a>  <span class="dt">name =</span> <span class="kw">col_character</span>(),</span>
<span id="cb7-4"><a href="import-data.html#cb7-4"></a>  <span class="dt">date_added =</span> <span class="kw">col_date</span>(<span class="dt">format =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb7-5"><a href="import-data.html#cb7-5"></a>  <span class="st">`</span><span class="dt">2015</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_double</span>(),</span>
<span id="cb7-6"><a href="import-data.html#cb7-6"></a>  <span class="st">`</span><span class="dt">2016</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_double</span>(),</span>
<span id="cb7-7"><a href="import-data.html#cb7-7"></a>  <span class="st">`</span><span class="dt">2017</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_double</span>(),</span>
<span id="cb7-8"><a href="import-data.html#cb7-8"></a>  <span class="st">`</span><span class="dt">2018</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_double</span>()</span>
<span id="cb7-9"><a href="import-data.html#cb7-9"></a>)</span>
<span id="cb7-10"><a href="import-data.html#cb7-10"></a></span>
<span id="cb7-11"><a href="import-data.html#cb7-11"></a>raw_vendors &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="st">&#39;data/vendor_master.csv&#39;</span>, <span class="dt">delim =</span> <span class="st">&quot;,&quot;</span>, <span class="dt">col_types =</span> cols)</span>
<span id="cb7-12"><a href="import-data.html#cb7-12"></a></span>
<span id="cb7-13"><a href="import-data.html#cb7-13"></a><span class="kw">glimpse</span>(raw_vendors)</span></code></pre></div>
<pre><code>## Rows: 9
## Columns: 9
## $ id         &lt;chr&gt; &quot;793&quot;, &quot;666&quot;, &quot;77&quot;, &quot;2726&quot;, &quot;2612&quot;, &quot;2211&quot;, &quot;2726&quot;, &quot;2612&quot;…
## $ type       &lt;chr&gt; &quot;E&quot;, &quot;E&quot;, &quot;E&quot;, &quot;V&quot;, &quot;V&quot;, &quot;V&quot;, &quot;V&quot;, &quot;V&quot;, &quot;V&quot;
## $ name       &lt;chr&gt; &quot;al-Bangura, Habeeba&quot;, &quot;Akina, Duncan&quot;, &quot;el-Kazmi, Muneefa…
## $ date_added &lt;date&gt; 2015-07-15, 2015-07-28, 2015-05-26, 2015-05-23, 2015-07-0…
## $ summary    &lt;chr&gt; NA, NA, NA, &quot;spend&quot;, &quot;spend&quot;, &quot;spend&quot;, &quot;credits&quot;, &quot;credits…
## $ `2015`     &lt;dbl&gt; NA, NA, NA, 65325.5287, 88270.0937, 51847.2728, 509.4308, …
## $ `2016`     &lt;dbl&gt; NA, NA, NA, 83413.7426, 148569.7780, 89260.3035, 860.3997,…
## $ `2017`     &lt;dbl&gt; NA, NA, NA, 150261.9517, 254178.2672, 142074.7898, 908.947…
## $ `2018`     &lt;dbl&gt; NA, NA, NA, 55569.8474, 179056.0944, 76761.0587, 347.9129,…</code></pre>
<p>You may have noticed that while our normal columns are specified as-is, we had to wrap our years with backticks (`), because while a column can technically be a number, asking R to reference a number will interpret it as a value, and not a field name.</p>
<div id="handling-problematic-delimited-files" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Handling problematic delimited files</h3>
<p>While well exported delimited files can be useful, they often contain hidden surprises. Consider this rather innocuous CSV file from active directory (the controller for Windows authentication), with a username and manager fields:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="import-data.html#cb9-1"></a><span class="co"># Active directory file, with just a username and manager field.</span></span>
<span id="cb9-2"><a href="import-data.html#cb9-2"></a></span>
<span id="cb9-3"><a href="import-data.html#cb9-3"></a><span class="kw">download.file</span>(<span class="dt">url =</span> <span class="st">&quot;https://github.com/jonlinca/auditanalytics/raw/master/data/active_directory.csv&quot;</span>,</span>
<span id="cb9-4"><a href="import-data.html#cb9-4"></a>              <span class="dt">destfile =</span> <span class="st">&quot;data/active_directory.csv&quot;</span>, <span class="dt">mode =</span> <span class="st">&quot;wb&quot;</span>) <span class="co"># Downloads this csv file into the data folder</span></span>
<span id="cb9-5"><a href="import-data.html#cb9-5"></a></span>
<span id="cb9-6"><a href="import-data.html#cb9-6"></a>raw_ad &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="st">&#39;data/active_directory.csv&#39;</span>, <span class="dt">delim =</span> <span class="st">&quot;;&quot;</span>)</span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   uid = col_character(),
##   manager = col_character()
## )</code></pre>
<pre><code>## Warning: 2 parsing failures.
## row col  expected    actual                        file
##   2  -- 2 columns 1 columns &#39;data/active_directory.csv&#39;
##   4  -- 2 columns 1 columns &#39;data/active_directory.csv&#39;</code></pre>
<p>These warnings indicate that there were columns expected (as dictated by the first line of column headers), but missing in one or more lines. You can inspect the CSV file in the RStudio interface by clicking on the file on the navigation pane to the right, and select ‘View File’. You will notice that the location for both accounts is on a new line, but it belongs to the prior record. The raw characters can be confirmed within R, by reading the file directly as is (i.e. raw):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="import-data.html#cb12-1"></a>ad_char &lt;-<span class="st"> </span><span class="kw">readChar</span>(<span class="st">&#39;data/active_directory.csv&#39;</span>, <span class="kw">file.info</span>(<span class="st">&#39;data/active_directory.csv&#39;</span>)<span class="op">$</span>size)</span>
<span id="cb12-2"><a href="import-data.html#cb12-2"></a></span>
<span id="cb12-3"><a href="import-data.html#cb12-3"></a><span class="kw">print</span>(ad_char)</span></code></pre></div>
<pre><code>## [1] &quot;uid;manager\r\njonlin; jason durrand\nlocation: calgary\r\nronaldlee; reid turra\nlocation: melbourne&quot;</code></pre>
<p>These special characters are hidden within the seemingly innocuous delimited file, and are typical of systems where information is extracted from, especially Windows, <code>\r</code> represents a carriage return, and <code>\n</code> represents a line feed. Together, <code>\r\n</code> represents a new line and new record, while <code>\n</code> can appear in a file when a new line is made by pressing Shift+Enter.</p>
<p>In this common yet inconvenient case, these can be substituted out with regular expressions. Regular expressions are a standard, cryptic yet powerful way to match text in strings. We will cover specific use cases of these in <a href="test.html#test-searchtext">Searching Text</a>.</p>
<p>In this case, the below regular expression only replaces <code>\n</code> when there is no <code>\r</code> preceding it. The <code>gsub()</code> function will try to match the regular expression criteria in the in the first field, with its replacement value in the second field.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="import-data.html#cb14-1"></a><span class="kw">gsub</span>(<span class="st">&quot;(?&lt;!</span><span class="ch">\\</span><span class="st">r)</span><span class="ch">\\</span><span class="st">n&quot;</span>,<span class="st">&quot; &quot;</span>, ad_char, <span class="dt">perl =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;uid;manager\r\njonlin; jason durrand location: calgary\r\nronaldlee; reid turra location: melbourne&quot;</code></pre>
<p>The gsub output shows that the manager’s name and location no longer has a <code>\n</code> in between them. As a result, it can now be imported cleanly.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="import-data.html#cb16-1"></a>ad_raw &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="kw">gsub</span>(<span class="st">&quot;(?&lt;!</span><span class="ch">\\</span><span class="st">r)</span><span class="ch">\\</span><span class="st">n&quot;</span>,<span class="st">&quot; &quot;</span>, ad_char, <span class="dt">perl =</span> <span class="ot">TRUE</span>), <span class="dt">delim =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb16-2"><a href="import-data.html#cb16-2"></a></span>
<span id="cb16-3"><a href="import-data.html#cb16-3"></a><span class="kw">print</span>(ad_raw)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   uid       manager                           
##   &lt;chr&gt;     &lt;chr&gt;                             
## 1 jonlin    &quot; jason durrand location: calgary&quot;
## 2 ronaldlee &quot; reid turra location: melbourne&quot;</code></pre>
</div>
</div>
<div id="import-db" class="section level2">
<h2><span class="header-section-number">5.2</span> Databases</h2>
<p>It is likely that the company you are auditing will have their data stored in a database. While having skills in SQL is recommended, having R skills means you are able to perform basic queries on databases. There are many different database brands and vendors in the world, and thus there are many different subtleties on how SQL works for each vendor, but they all operate on the same standard.</p>
<p>The Open Databases Connectivity (ODBC) standard allows different vendors to write drivers, or the technical back-end methods, to connect to their database. Generally, you will need a driver that matches the vendor and version of the database you’re using.</p>
<p>The Database Interface (DBI) is the interaction between R and the driver. Practically speaking, it enables R to send queries to the database via the driver that is defined in the ODBC.</p>
<p>The most common way to connect to a database on your network is to install the vendor drivers, and then create a Data Source Name (DSN). To properly create this DSN, you’ll need the name of your database, as well as read-only credentials. Alternatively, you may specify the server name, database schema and credentials explicitly, which offers some advantages from a portability perspective as your other team mates will not need to create DSNs, and only need to install the drivers themselves.</p>
<p>For this example, we will use an SQLite database. Unlike commercial databases you have to install, configure and hire database administrators to manage, a SQLite database is a small self-sustaining file. SQLite files can be kept in your normal documents folders, and are perfect for lightweight applications (including training!)</p>
<p>Again, lets start by downloading the file, or in this case, a database:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="import-data.html#cb18-1"></a><span class="kw">dir.create</span>(<span class="st">&quot;data&quot;</span>, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)</span>
<span id="cb18-2"><a href="import-data.html#cb18-2"></a></span>
<span id="cb18-3"><a href="import-data.html#cb18-3"></a><span class="kw">download.file</span>(<span class="dt">url =</span> <span class="st">&quot;https://github.com/jonlinca/auditanalytics/raw/master/data/rauditanalytics.sqlite&quot;</span>,</span>
<span id="cb18-4"><a href="import-data.html#cb18-4"></a>             <span class="dt">destfile =</span> <span class="st">&quot;data/rauditanalytics.sqlite&quot;</span>, <span class="dt">mode =</span> <span class="st">&quot;wb&quot;</span>)</span></code></pre></div>
<p>One thing that is different about connecting to databases is that you need to set up a database connection within R. This will usually consist of a driver (in this case, <code>RSQLite::SQLite()</code>), a DSN or a file location (<code>data/rauditanalytics.sqlite</code>). In the help file, it asks for other needed fields as well; user, password, host etc. At your company, having that information along with ports, schema names, and whether or not its a trusted connection (authenticating automatically with your own active directory credentials). If you haven’t yet already at your company, request a read-only account that can get this information.</p>
<p>We’re going to establish a connection with the database, creating the <code>con</code> connection object:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="import-data.html#cb19-1"></a>con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(RSQLite<span class="op">::</span><span class="kw">SQLite</span>(), <span class="st">&quot;data/rauditanalytics.sqlite&quot;</span>)</span></code></pre></div>
<p>You can confirm the connection works correctly by listing the tables in the database. One important thing to remember is that you’ll be passing this connection object each time as you perform your commands. For example, if you want to see what tables exist in the database and schema, you will still need to tell the command which database you want to connect to.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="import-data.html#cb20-1"></a><span class="kw">dbListTables</span>(con)</span></code></pre></div>
<pre><code>## [1] &quot;gl&quot;       &quot;industry&quot; &quot;tb&quot;       &quot;vendors&quot;</code></pre>
<p>To get data out of a database, you’ll need to communicate to it with SQL (Structured Query Language). Here is an example of how to select all the records in a table:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="import-data.html#cb22-1"></a><span class="kw">dbGetQuery</span>(con, <span class="st">&#39;select * from gl&#39;</span>)</span></code></pre></div>
<pre><code>##   je_num   amount gl_date gl_date_char vendor_id            account
## 1      1 22667.46   18232   2019-12-02      2211 exp_materials_6000
##   invoice_date         description paid_date
## 1        18225 Packaging and boxes     18262
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 1999 rows ]</code></pre>
<p>While knowing SQL is advantageous (and eventually critical), sometimes switching between languages is a hassle, especially when performing basic tasks within a database. Using the <strong>dplyr</strong> package, you can generate several of the same SQL queries using R syntax. All you need to do is create a reference to the table in the connection object - in this case, the <code>con</code> connection object contains the <code>gl</code> table:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="import-data.html#cb24-1"></a>db_gl &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="st">&#39;gl&#39;</span>)</span>
<span id="cb24-2"><a href="import-data.html#cb24-2"></a></span>
<span id="cb24-3"><a href="import-data.html#cb24-3"></a>db_gl</span></code></pre></div>
<pre><code>## # Source:   table&lt;gl&gt; [?? x 9]
## # Database: sqlite 3.30.1
## #   [/Users/jon/Documents/R/auditanalytics/data/rauditanalytics.sqlite]
##    je_num  amount gl_date gl_date_char vendor_id account invoice_date
##     &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;            &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;
##  1      1  22667.   18232 2019-12-02        2211 exp_ma…        18225
##  2      1 -22667.   18232 2019-12-02          NA liab_a…        18225
##  3      2   1397.   18228 2019-11-28        2612 exp_ma…        18218
##  4      2  -1397.   18228 2019-11-28          NA liab_a…        18218
##  5      3   2319.   17995 2019-04-09        2612 exp_ma…        17985
##  6      3  -2319.   17995 2019-04-09          NA liab_a…        17985
##  7      4  20037.   18199 2019-10-30        2612 exp_ma…        18189
##  8      4 -20037.   18199 2019-10-30          NA liab_a…        18189
##  9      5  43140.   18051 2019-06-04        2612 exp_ma…        18041
## 10      5 -43140.   18051 2019-06-04          NA liab_a…        18041
## # … with more rows, and 2 more variables: description &lt;chr&gt;, paid_date &lt;dbl&gt;</code></pre>
<p>Not only is it pointing to the same table, but its also performing the same query, even though it was made up using R and dplyr:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="import-data.html#cb26-1"></a>db_gl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-2"><a href="import-data.html#cb26-2"></a><span class="st">  </span><span class="kw">show_query</span>()</span></code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT *
## FROM `gl`</code></pre>
<p>There are a few differences though between using these approaches.</p>
<ul>
<li><p><code>dbGetQuery()</code> will return a data.frame that is immediately usable, while creating the table connection via <code>tbl()</code> results in a preview of the query but hasn’t been formally downloaded in the database. In order to use the data within R with <code>tbl()</code>, a further <code>collect()</code> is needed. Instead of performing a data download every time, it is advantageous to preview the results first before collecting it.</p></li>
<li><p><code>dbGetQuery</code> requires the entire SQL query to be pre-written, and can not be further leveraged within the database. However, the <code>tbl</code> object can still be further manipulated. This is especially useful when creating new fields or performing joins in same database.</p></li>
</ul>
<p>Lets say that you wanted to filter amounts greater than $75,000 in the database. In the SQL method, you would need to type a whole new SQL query:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="import-data.html#cb28-1"></a><span class="kw">dbGetQuery</span>(con, <span class="st">&#39;select * from gl where amount &gt; 75000&#39;</span>)</span></code></pre></div>
<pre><code>##   je_num   amount gl_date gl_date_char vendor_id            account
## 1    140 96354.61   18249   2019-12-19      2211 exp_materials_6000
##   invoice_date         description paid_date
## 1        18242 Packaging and boxes     18279
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 1 rows ]</code></pre>
<p>Where in the dplyr method, you would only need to build on the same connection object already established. Identical queries, and results</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="import-data.html#cb30-1"></a>db_gl_threshold &lt;-<span class="st"> </span>db_gl <span class="op">%&gt;%</span></span>
<span id="cb30-2"><a href="import-data.html#cb30-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(amount <span class="op">&gt;</span><span class="st"> </span><span class="dv">75000</span>)</span>
<span id="cb30-3"><a href="import-data.html#cb30-3"></a></span>
<span id="cb30-4"><a href="import-data.html#cb30-4"></a>db_gl_threshold</span></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 9]
## # Database: sqlite 3.30.1
## #   [/Users/jon/Documents/R/auditanalytics/data/rauditanalytics.sqlite]
##   je_num amount gl_date gl_date_char vendor_id account invoice_date description
##    &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;            &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;      
## 1    140 96355.   18249 2019-12-19        2211 exp_ma…        18242 Packaging …
## 2    693 88524.   18121 2019-08-13        2726 exp_ma…        18114 Quality co…
## # … with 1 more variable: paid_date &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="import-data.html#cb32-1"></a><span class="kw">show_query</span>(db_gl_threshold)</span></code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT *
## FROM `gl`
## WHERE (`amount` &gt; 75000.0)</code></pre>
<p>And when you’re happy with this, simply <code>collect()</code> to save the query results as a data frame. To be nice to your database administrators, you should also disconnect from the database to free up a connection.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="import-data.html#cb34-1"></a>gl_threshold &lt;-<span class="st"> </span>db_gl_threshold <span class="op">%&gt;%</span></span>
<span id="cb34-2"><a href="import-data.html#cb34-2"></a><span class="st">  </span><span class="kw">collect</span>()</span>
<span id="cb34-3"><a href="import-data.html#cb34-3"></a></span>
<span id="cb34-4"><a href="import-data.html#cb34-4"></a><span class="kw">dbDisconnect</span>(con)</span></code></pre></div>
<p>We will go through an advanced application of setting up database queries in <a href="auditpackage.html#auditpackage">Audit Package Creation</a>, which builds upon leveraging dplyr to create the pieces that enable powerful queries.</p>
</div>
<div id="apis" class="section level2">
<h2><span class="header-section-number">5.3</span> APIs</h2>
<p>As more applications are hosted on the cloud, it is an important skill to obtain information from them without resorting to manually triggered reports. Data can be accessed from these systems via an <strong>Application Programming Interface</strong> (API), and typically it is exposed via the method Representational State Transfer (REST). An API will allow one application to talk to another. Some examples of APIs are web sites with search functions, or loading a list of comments other users have published, or determining who is friends with whom. REST advises how the endpoint is structured, and also suggests how the data is returned.</p>
<p>While APIs may appear to be daunting, retrieving data from them is not difficult at all. A user needs to know what they want, then:</p>
<ul>
<li>match what is desired to the ‘endpoint’, a pre-defined url or path where the data resides,</li>
<li>send a valid request to <code>GET</code> the data, and</li>
<li>receive the response.</li>
</ul>
<p>Here is an example. Lets say you want to see what repositories I have available to the public on GitHub.</p>
<ul>
<li>You look up the GitHub API documentation, and discover you can <a href="https://developer.github.com/v3/repos/#list-repositories-for-a-user">list what repositories a user has</a>.</li>
<li>You formulate your request, and the request URL becomes <code>https://api.github.com/users/jonlinca/repos</code></li>
<li>Then you send the above URL using the httr package and the <code>GET</code> command.</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="import-data.html#cb35-1"></a><span class="kw">library</span>(httr)</span>
<span id="cb35-2"><a href="import-data.html#cb35-2"></a><span class="kw">library</span>(jsonlite)</span>
<span id="cb35-3"><a href="import-data.html#cb35-3"></a></span>
<span id="cb35-4"><a href="import-data.html#cb35-4"></a>response &lt;-<span class="st"> </span><span class="kw">GET</span>(<span class="st">&#39;https://api.github.com/users/jonlinca/repos&#39;</span>) <span class="co"># Endpoint</span></span>
<span id="cb35-5"><a href="import-data.html#cb35-5"></a></span>
<span id="cb35-6"><a href="import-data.html#cb35-6"></a>response</span></code></pre></div>
<pre><code>## Response [https://api.github.com/users/jonlinca/repos]
##   Date: 2020-11-12 06:15
##   Status: 200
##   Content-Type: application/json; charset=utf-8
##   Size: 34.1 kB
## [
##   {
##     &quot;id&quot;: 129155075,
##     &quot;node_id&quot;: &quot;MDEwOlJlcG9zaXRvcnkxMjkxNTUwNzU=&quot;,
##     &quot;name&quot;: &quot;ACLandR_DeployingModels&quot;,
##     &quot;full_name&quot;: &quot;jonlinca/ACLandR_DeployingModels&quot;,
##     &quot;private&quot;: false,
##     &quot;owner&quot;: {
##       &quot;login&quot;: &quot;jonlinca&quot;,
##       &quot;id&quot;: 29468012,
## ...</code></pre>
<p>The structure of the data in an API looks different than a data frame. Typically there is an overall response (indicating success or the nature of the failure), the type of content (in this case, ‘application/json’), and the data itself. The entire download is usually stored as a list with multiple references:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="import-data.html#cb37-1"></a><span class="kw">names</span>(response)</span></code></pre></div>
<pre><code>##  [1] &quot;url&quot;         &quot;status_code&quot; &quot;headers&quot;     &quot;all_headers&quot; &quot;cookies&quot;    
##  [6] &quot;content&quot;     &quot;date&quot;        &quot;times&quot;       &quot;request&quot;     &quot;handle&quot;</code></pre>
<p>And the data you want will be in the response’s <code>$content</code>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="import-data.html#cb39-1"></a><span class="kw">head</span>(response<span class="op">$</span>content)</span></code></pre></div>
<pre><code>## [1] 5b 0a 20 20 7b 0a</code></pre>
<p>This raw data is generally uninterpretable, and it is because the structure of the data is in a different format - in this case, the Content-Type above indicates it is a json file. Its quite easy to convert the data in this format to something more understandable with the httr <code>content()</code> and jsonlite <code>fromJSON()</code> and <code>toJSON()</code> functions:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="import-data.html#cb41-1"></a>content &lt;-<span class="st"> </span><span class="kw">content</span>(response)</span>
<span id="cb41-2"><a href="import-data.html#cb41-2"></a></span>
<span id="cb41-3"><a href="import-data.html#cb41-3"></a>cleancontent &lt;-<span class="st"> </span>jsonlite<span class="op">::</span><span class="kw">fromJSON</span>(jsonlite<span class="op">::</span><span class="kw">toJSON</span>(content), <span class="dt">flatten =</span> <span class="ot">TRUE</span>)</span>
<span id="cb41-4"><a href="import-data.html#cb41-4"></a></span>
<span id="cb41-5"><a href="import-data.html#cb41-5"></a><span class="co"># Print it out</span></span>
<span id="cb41-6"><a href="import-data.html#cb41-6"></a>cleancontent[,<span class="kw">c</span>(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;name&#39;</span>)]</span></code></pre></div>
<pre><code>##          id                    name
## 1 129155075 ACLandR_DeployingModels
## 2 164948874          ACLandR_KMeans
## 3 269707027          auditanalytics
## 4 183726578                calgaryr
## 5 277917653              galvanizer
## 6 298054213                 onepass</code></pre>
<p>Some data sources may be difficult to obtain data from, or perhaps you’re not quite ready at the technical skill level to develop your own data connectivity for APIs. One alternative for such information is the use of a third party tool - for example, <a href="https://www.cdata.com/kb/tech/office365-jdbc-r.rst">CData</a> supports an interface that allows you to interact with programs like Office 365 (including emails and file audit logs) directly. Office 365 also offers APIs that expose Sharepoint and Outlook, although they take more time to understand.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="setup.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-completeness.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Audit_Analytics_with-R.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
