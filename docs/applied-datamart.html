<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 14 Audit Data Mart | Audit Analytics with R</title>
  <meta name="description" content="A toolkit for Internal Audit and Financial auditors" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 14 Audit Data Mart | Audit Analytics with R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://auditanalytics.jonlin.ca/" />
  
  <meta property="og:description" content="A toolkit for Internal Audit and Financial auditors" />
  <meta name="github-repo" content="jonlinca/auditanalytics" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 14 Audit Data Mart | Audit Analytics with R" />
  
  <meta name="twitter:description" content="A toolkit for Internal Audit and Financial auditors" />
  

<meta name="author" content="Jonathan Lin" />


<meta name="date" content="2020-11-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="continuous-monitoring.html"/>
<link rel="next" href="appendix-ca.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<script src="libs/d3-3.3.8/d3.min.js"></script>
<script src="libs/dagre-0.4.0/dagre-d3.min.js"></script>
<link href="libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet" />
<script src="libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script>
<script src="libs/chromatography-0.1/chromatography.js"></script>
<script src="libs/DiagrammeR-binding-1.0.6.1/DiagrammeR.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.14/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Audit Analytics in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the author</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="part"><span><b>I Structure</b></span></li>
<li class="chapter" data-level="2" data-path="approach.html"><a href="approach.html"><i class="fa fa-check"></i><b>2</b> Approach</a><ul>
<li class="chapter" data-level="2.1" data-path="approach.html"><a href="approach.html#code-based-development"><i class="fa fa-check"></i><b>2.1</b> Code-based development</a></li>
<li class="chapter" data-level="2.2" data-path="approach.html"><a href="approach.html#automate-relentlessly"><i class="fa fa-check"></i><b>2.2</b> Automate relentlessly</a></li>
<li class="chapter" data-level="2.3" data-path="approach.html"><a href="approach.html#share-everything"><i class="fa fa-check"></i><b>2.3</b> Share everything</a></li>
<li class="chapter" data-level="2.4" data-path="approach.html"><a href="approach.html#always-deliver-useful-product"><i class="fa fa-check"></i><b>2.4</b> Always deliver useful product</a></li>
<li class="chapter" data-level="2.5" data-path="approach.html"><a href="approach.html#dont-be-a-hero"><i class="fa fa-check"></i><b>2.5</b> Don’t be a hero</a></li>
<li class="chapter" data-level="2.6" data-path="approach.html"><a href="approach.html#the-opportunity-cost"><i class="fa fa-check"></i><b>2.6</b> “The opportunity cost”</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="architecture.html"><a href="architecture.html"><i class="fa fa-check"></i><b>3</b> Architecture</a><ul>
<li class="chapter" data-level="3.1" data-path="architecture.html"><a href="architecture.html#architecture-r"><i class="fa fa-check"></i><b>3.1</b> R and RStudio</a></li>
<li class="chapter" data-level="3.2" data-path="architecture.html"><a href="architecture.html#code-repositories"><i class="fa fa-check"></i><b>3.2</b> Code repositories</a><ul>
<li class="chapter" data-level="3.2.1" data-path="architecture.html"><a href="architecture.html#git"><i class="fa fa-check"></i><b>3.2.1</b> git</a></li>
<li class="chapter" data-level="3.2.2" data-path="architecture.html"><a href="architecture.html#packages"><i class="fa fa-check"></i><b>3.2.2</b> Packages</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="architecture.html"><a href="architecture.html#data-products"><i class="fa fa-check"></i><b>3.3</b> Data products</a><ul>
<li class="chapter" data-level="3.3.1" data-path="architecture.html"><a href="architecture.html#galvanize-highbond"><i class="fa fa-check"></i><b>3.3.1</b> Galvanize Highbond</a></li>
<li class="chapter" data-level="3.3.2" data-path="architecture.html"><a href="architecture.html#architecture-rsc"><i class="fa fa-check"></i><b>3.3.2</b> RStudio Connect</a></li>
<li class="chapter" data-level="3.3.3" data-path="architecture.html"><a href="architecture.html#rstudio-package-manager"><i class="fa fa-check"></i><b>3.3.3</b> RStudio Package Manager</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="architecture.html"><a href="architecture.html#data-sources"><i class="fa fa-check"></i><b>3.4</b> Data sources</a><ul>
<li class="chapter" data-level="3.4.1" data-path="architecture.html"><a href="architecture.html#internal-databases"><i class="fa fa-check"></i><b>3.4.1</b> Internal databases</a></li>
<li class="chapter" data-level="3.4.2" data-path="architecture.html"><a href="architecture.html#external-sources"><i class="fa fa-check"></i><b>3.4.2</b> External sources</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="architecture.html"><a href="architecture.html#audit-data-mart"><i class="fa fa-check"></i><b>3.5</b> Audit data mart</a></li>
</ul></li>
<li class="part"><span><b>II Technical</b></span></li>
<li class="chapter" data-level="4" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>4</b> Setup</a><ul>
<li class="chapter" data-level="4.1" data-path="setup.html"><a href="setup.html#setup-r"><i class="fa fa-check"></i><b>4.1</b> R with RStudio</a></li>
<li class="chapter" data-level="4.2" data-path="setup.html"><a href="setup.html#common-packages"><i class="fa fa-check"></i><b>4.2</b> Common packages</a></li>
<li class="chapter" data-level="4.3" data-path="setup.html"><a href="setup.html#highbond-r-package"><i class="fa fa-check"></i><b>4.3</b> Highbond R package</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="import-data.html"><a href="import-data.html"><i class="fa fa-check"></i><b>5</b> Import data</a><ul>
<li class="chapter" data-level="5.1" data-path="import-data.html"><a href="import-data.html#delimited-files"><i class="fa fa-check"></i><b>5.1</b> Delimited files</a><ul>
<li class="chapter" data-level="5.1.1" data-path="import-data.html"><a href="import-data.html#handling-problematic-delimited-files"><i class="fa fa-check"></i><b>5.1.1</b> Handling problematic delimited files</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="import-data.html"><a href="import-data.html#import-db"><i class="fa fa-check"></i><b>5.2</b> Databases</a></li>
<li class="chapter" data-level="5.3" data-path="import-data.html"><a href="import-data.html#apis"><i class="fa fa-check"></i><b>5.3</b> APIs</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-completeness.html"><a href="data-completeness.html"><i class="fa fa-check"></i><b>6</b> Data Completeness</a><ul>
<li class="chapter" data-level="6.1" data-path="data-completeness.html"><a href="data-completeness.html#exploration-of-general-ledger-data"><i class="fa fa-check"></i><b>6.1</b> Exploration of General Ledger data</a></li>
<li class="chapter" data-level="6.2" data-path="data-completeness.html"><a href="data-completeness.html#examination-of-potential-errors"><i class="fa fa-check"></i><b>6.2</b> Examination of potential errors</a><ul>
<li class="chapter" data-level="6.2.1" data-path="data-completeness.html"><a href="data-completeness.html#completeness-na"><i class="fa fa-check"></i><b>6.2.1</b> NA values</a></li>
<li class="chapter" data-level="6.2.2" data-path="data-completeness.html"><a href="data-completeness.html#journal-entries-balance-to-zero"><i class="fa fa-check"></i><b>6.2.2</b> Journal Entries balance to zero</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="data-completeness.html"><a href="data-completeness.html#transforming-of-trial-balance-data"><i class="fa fa-check"></i><b>6.3</b> Transforming of Trial Balance data</a><ul>
<li class="chapter" data-level="6.3.1" data-path="data-completeness.html"><a href="data-completeness.html#sum-by-absolute-references"><i class="fa fa-check"></i><b>6.3.1</b> Sum by absolute references</a></li>
<li class="chapter" data-level="6.3.2" data-path="data-completeness.html"><a href="data-completeness.html#sum-by-numeric-position"><i class="fa fa-check"></i><b>6.3.2</b> Sum by numeric position</a></li>
<li class="chapter" data-level="6.3.3" data-path="data-completeness.html"><a href="data-completeness.html#sum-by-named-references"><i class="fa fa-check"></i><b>6.3.3</b> Sum by named references</a></li>
<li class="chapter" data-level="6.3.4" data-path="data-completeness.html"><a href="data-completeness.html#pivot-then-summarize"><i class="fa fa-check"></i><b>6.3.4</b> Pivot then summarize</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="data-completeness.html"><a href="data-completeness.html#asserting-completeness"><i class="fa fa-check"></i><b>6.4</b> Asserting Completeness</a><ul>
<li class="chapter" data-level="6.4.1" data-path="data-completeness.html"><a href="data-completeness.html#completeness-join"><i class="fa fa-check"></i><b>6.4.1</b> Joining the GL to the TB</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="data-completeness.html"><a href="data-completeness.html#cautionary-notes-for-completeness"><i class="fa fa-check"></i><b>6.5</b> Cautionary notes for Completeness</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="cleaning-data.html"><a href="cleaning-data.html"><i class="fa fa-check"></i><b>7</b> Cleaning data</a><ul>
<li class="chapter" data-level="7.1" data-path="cleaning-data.html"><a href="cleaning-data.html#basic-math"><i class="fa fa-check"></i><b>7.1</b> Basic math</a></li>
<li class="chapter" data-level="7.2" data-path="cleaning-data.html"><a href="cleaning-data.html#dates-and-times"><i class="fa fa-check"></i><b>7.2</b> Dates and Times</a><ul>
<li class="chapter" data-level="7.2.1" data-path="cleaning-data.html"><a href="cleaning-data.html#understanding-default-time-zones"><i class="fa fa-check"></i><b>7.2.1</b> Understanding Default Time Zones</a></li>
<li class="chapter" data-level="7.2.2" data-path="cleaning-data.html"><a href="cleaning-data.html#override-or-display-timezones"><i class="fa fa-check"></i><b>7.2.2</b> Override or display timezones</a></li>
<li class="chapter" data-level="7.2.3" data-path="cleaning-data.html"><a href="cleaning-data.html#daylight-saving-implications"><i class="fa fa-check"></i><b>7.2.3</b> Daylight Saving Implications</a></li>
<li class="chapter" data-level="7.2.4" data-path="cleaning-data.html"><a href="cleaning-data.html#differences-between-time"><i class="fa fa-check"></i><b>7.2.4</b> Differences between time</a></li>
<li class="chapter" data-level="7.2.5" data-path="cleaning-data.html"><a href="cleaning-data.html#derived-date-information"><i class="fa fa-check"></i><b>7.2.5</b> Derived date information</a></li>
<li class="chapter" data-level="7.2.6" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-numerical-dates"><i class="fa fa-check"></i><b>7.2.6</b> Cleaning numerical dates</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="cleaning-data.html"><a href="cleaning-data.html#separate"><i class="fa fa-check"></i><b>7.3</b> Separate</a></li>
<li class="chapter" data-level="7.4" data-path="cleaning-data.html"><a href="cleaning-data.html#separate_rows"><i class="fa fa-check"></i><b>7.4</b> Separate_rows</a></li>
<li class="chapter" data-level="7.5" data-path="cleaning-data.html"><a href="cleaning-data.html#tidy-data"><i class="fa fa-check"></i><b>7.5</b> Tidy data</a></li>
<li class="chapter" data-level="7.6" data-path="cleaning-data.html"><a href="cleaning-data.html#clean-pivot"><i class="fa fa-check"></i><b>7.6</b> Pivots, wide and longer</a></li>
<li class="chapter" data-level="7.7" data-path="cleaning-data.html"><a href="cleaning-data.html#joining-data"><i class="fa fa-check"></i><b>7.7</b> Joining data</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exploring-data.html"><a href="exploring-data.html"><i class="fa fa-check"></i><b>8</b> Exploring data</a><ul>
<li class="chapter" data-level="8.1" data-path="exploring-data.html"><a href="exploring-data.html#explore-stats"><i class="fa fa-check"></i><b>8.1</b> Basic Statistics</a></li>
<li class="chapter" data-level="8.2" data-path="exploring-data.html"><a href="exploring-data.html#summarizations"><i class="fa fa-check"></i><b>8.2</b> Summarizations</a></li>
<li class="chapter" data-level="8.3" data-path="exploring-data.html"><a href="exploring-data.html#data-visualization---why"><i class="fa fa-check"></i><b>8.3</b> Data Visualization - Why</a></li>
<li class="chapter" data-level="8.4" data-path="exploring-data.html"><a href="exploring-data.html#data-visualization---how"><i class="fa fa-check"></i><b>8.4</b> Data Visualization - How</a><ul>
<li class="chapter" data-level="8.4.1" data-path="exploring-data.html"><a href="exploring-data.html#time-series"><i class="fa fa-check"></i><b>8.4.1</b> Time-series</a></li>
<li class="chapter" data-level="8.4.2" data-path="exploring-data.html"><a href="exploring-data.html#facets"><i class="fa fa-check"></i><b>8.4.2</b> Facets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="test.html"><a href="test.html"><i class="fa fa-check"></i><b>9</b> Test</a><ul>
<li class="chapter" data-level="9.1" data-path="test.html"><a href="test.html#amount-based-tests"><i class="fa fa-check"></i><b>9.1</b> Amount-based tests</a><ul>
<li class="chapter" data-level="9.1.1" data-path="test.html"><a href="test.html#above-te"><i class="fa fa-check"></i><b>9.1.1</b> Above threshold</a></li>
<li class="chapter" data-level="9.1.2" data-path="test.html"><a href="test.html#round-numbers"><i class="fa fa-check"></i><b>9.1.2</b> Round numbers</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="test.html"><a href="test.html#date-based-tests"><i class="fa fa-check"></i><b>9.2</b> Date-based tests</a><ul>
<li class="chapter" data-level="9.2.1" data-path="test.html"><a href="test.html#weekend-testing"><i class="fa fa-check"></i><b>9.2.1</b> Weekend testing</a></li>
<li class="chapter" data-level="9.2.2" data-path="test.html"><a href="test.html#cutoff-testing"><i class="fa fa-check"></i><b>9.2.2</b> Cutoff testing</a></li>
<li class="chapter" data-level="9.2.3" data-path="test.html"><a href="test.html#age"><i class="fa fa-check"></i><b>9.2.3</b> Age</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="test.html"><a href="test.html#basic-statistical-tests"><i class="fa fa-check"></i><b>9.3</b> Basic Statistical tests</a><ul>
<li class="chapter" data-level="9.3.1" data-path="test.html"><a href="test.html#outliers-based-on-amount"><i class="fa fa-check"></i><b>9.3.1</b> Outliers based on amount</a></li>
<li class="chapter" data-level="9.3.2" data-path="test.html"><a href="test.html#outliers-based-on-amounts-and-other-factors"><i class="fa fa-check"></i><b>9.3.2</b> Outliers based on amounts and other factors</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="test.html"><a href="test.html#unusual-pattern-and-behaviours"><i class="fa fa-check"></i><b>9.4</b> Unusual pattern and behaviours</a><ul>
<li class="chapter" data-level="9.4.1" data-path="test.html"><a href="test.html#benfords-law-analysis"><i class="fa fa-check"></i><b>9.4.1</b> Benford’s Law analysis</a></li>
<li class="chapter" data-level="9.4.2" data-path="test.html"><a href="test.html#relative-size-factor-rsf"><i class="fa fa-check"></i><b>9.4.2</b> Relative size factor (RSF)</a></li>
<li class="chapter" data-level="9.4.3" data-path="test.html"><a href="test.html#duplicate-invoices"><i class="fa fa-check"></i><b>9.4.3</b> Duplicate Invoices</a></li>
<li class="chapter" data-level="9.4.4" data-path="test.html"><a href="test.html#detecting-gaps-in-sequences"><i class="fa fa-check"></i><b>9.4.4</b> Detecting gaps in sequences</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="test.html"><a href="test.html#test-searchtext"><i class="fa fa-check"></i><b>9.5</b> Search text</a><ul>
<li class="chapter" data-level="9.5.1" data-path="test.html"><a href="test.html#regex-basics"><i class="fa fa-check"></i><b>9.5.1</b> Regex basics</a></li>
<li class="chapter" data-level="9.5.2" data-path="test.html"><a href="test.html#starts-or-ends-with-anchors"><i class="fa fa-check"></i><b>9.5.2</b> Starts or Ends with (Anchors)</a></li>
<li class="chapter" data-level="9.5.3" data-path="test.html"><a href="test.html#crash-course-in-encoding"><i class="fa fa-check"></i><b>9.5.3</b> Crash course in Encoding</a></li>
<li class="chapter" data-level="9.5.4" data-path="test.html"><a href="test.html#cleaning-text"><i class="fa fa-check"></i><b>9.5.4</b> Cleaning Text</a></li>
<li class="chapter" data-level="9.5.5" data-path="test.html"><a href="test.html#searching-multiple-fields"><i class="fa fa-check"></i><b>9.5.5</b> Searching Multiple Fields</a></li>
<li class="chapter" data-level="9.5.6" data-path="test.html"><a href="test.html#regex-further"><i class="fa fa-check"></i><b>9.5.6</b> Further reading</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="report.html"><a href="report.html"><i class="fa fa-check"></i><b>10</b> Report</a><ul>
<li class="chapter" data-level="10.1" data-path="report.html"><a href="report.html#report-structure"><i class="fa fa-check"></i><b>10.1</b> Report Structure</a></li>
<li class="chapter" data-level="10.2" data-path="report.html"><a href="report.html#export-files"><i class="fa fa-check"></i><b>10.2</b> Export files</a></li>
</ul></li>
<li class="part"><span><b>III Advanced teams</b></span></li>
<li class="chapter" data-level="11" data-path="applied-audit-analytics.html"><a href="applied-audit-analytics.html"><i class="fa fa-check"></i><b>11</b> Applied Audit Analytics</a></li>
<li class="chapter" data-level="12" data-path="auditpackage.html"><a href="auditpackage.html"><i class="fa fa-check"></i><b>12</b> Audit R Package</a><ul>
<li class="chapter" data-level="12.1" data-path="auditpackage.html"><a href="auditpackage.html#package-functions"><i class="fa fa-check"></i><b>12.1</b> Package functions</a></li>
<li class="chapter" data-level="12.2" data-path="auditpackage.html"><a href="auditpackage.html#templates"><i class="fa fa-check"></i><b>12.2</b> Templates</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html"><i class="fa fa-check"></i><b>13</b> Continuous monitoring</a><ul>
<li class="chapter" data-level="13.1" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html#considerations"><i class="fa fa-check"></i><b>13.1</b> Considerations</a></li>
<li class="chapter" data-level="13.2" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html#create-a-collection-analytic-and-table"><i class="fa fa-check"></i><b>13.2</b> Create a Collection, Analytic and Table</a></li>
<li class="chapter" data-level="13.3" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html#define-the-high-risk-test"><i class="fa fa-check"></i><b>13.3</b> Define the High Risk test</a></li>
<li class="chapter" data-level="13.4" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html#uploading-additional-results"><i class="fa fa-check"></i><b>13.4</b> Uploading additional results</a></li>
<li class="chapter" data-level="13.5" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html#downloading-records-and-responses"><i class="fa fa-check"></i><b>13.5</b> Downloading records and responses</a></li>
<li class="chapter" data-level="13.6" data-path="continuous-monitoring.html"><a href="continuous-monitoring.html#triggers-and-questionnaires"><i class="fa fa-check"></i><b>13.6</b> Triggers and Questionnaires</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="applied-datamart.html"><a href="applied-datamart.html"><i class="fa fa-check"></i><b>14</b> Audit Data Mart</a><ul>
<li class="chapter" data-level="14.1" data-path="applied-datamart.html"><a href="applied-datamart.html#what-to-etl"><i class="fa fa-check"></i><b>14.1</b> What to ETL</a></li>
<li class="chapter" data-level="14.2" data-path="applied-datamart.html"><a href="applied-datamart.html#etl-essentials"><i class="fa fa-check"></i><b>14.2</b> ETL Essentials</a></li>
<li class="chapter" data-level="14.3" data-path="applied-datamart.html"><a href="applied-datamart.html#etl-example"><i class="fa fa-check"></i><b>14.3</b> ETL Example</a></li>
</ul></li>
<li class="part"><span><b>IV Appendix</b></span></li>
<li class="chapter" data-level="15" data-path="appendix-ca.html"><a href="appendix-ca.html"><i class="fa fa-check"></i><b>15</b> Continuous Auditing methodology</a><ul>
<li class="chapter" data-level="15.1" data-path="appendix-ca.html"><a href="appendix-ca.html#support-for-continuous-auditing"><i class="fa fa-check"></i><b>15.1</b> Support for Continuous Auditing</a></li>
<li class="chapter" data-level="15.2" data-path="appendix-ca.html"><a href="appendix-ca.html#the-requirements-for-evaluting-icfr"><i class="fa fa-check"></i><b>15.2</b> The requirements for evaluting ICFR</a></li>
<li class="chapter" data-level="15.3" data-path="appendix-ca.html"><a href="appendix-ca.html#determining-population-tolerable-error-rate"><i class="fa fa-check"></i><b>15.3</b> Determining population tolerable error rate</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="other-practices-to-follow.html"><a href="other-practices-to-follow.html"><i class="fa fa-check"></i><b>16</b> Other practices to follow</a><ul>
<li class="chapter" data-level="16.1" data-path="other-practices-to-follow.html"><a href="other-practices-to-follow.html#documentation"><i class="fa fa-check"></i><b>16.1</b> Documentation</a></li>
<li class="chapter" data-level="16.2" data-path="other-practices-to-follow.html"><a href="other-practices-to-follow.html#passwords"><i class="fa fa-check"></i><b>16.2</b> Passwords</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Audit Analytics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="applied-datamart" class="section level1">
<h1><span class="header-section-number">Chapter 14</span> Audit Data Mart</h1>
<p>As auditors, you will likely pull from the general pool of data at your company to perform analysis. This information is likely organized in a <strong>data warehouse</strong>, where data quality is controlled and is oriented towards reporting. Sometimes, this information is simply too large and onerous for rapid reporting. A side effect of a well designed data warehouse is that the data is highly structured (normalized), and performing any trivial analysis requires joining multiple tables together.</p>
<p><strong>Data marts</strong> have existed to provide a smaller, more defined subset of information, that is developed with a specific need in mind. Generally a data mart is connected to the data warehouse, preparing the data via a process called extraction, transformation and load (ETL). Extraction is the retrieval of information from a flat file or database, transformation is the act of cleaning, joining and summarizing the information so it can be useful, and load is uploading the information into a database.</p>
<p>A data mart is generally considered to be relatively inexpensive, as you are only retaining specific information needed to answer most questions. It won’t replace the data warehouse, especially for historical transactions, but it is good for smaller snapshots of information.</p>
<div id="what-to-etl" class="section level2">
<h2><span class="header-section-number">14.1</span> What to ETL</h2>
<p>Good candidates for content in a data mart is generally information that takes a long time to generate for any individual’s computer, and would be useful to multiple individuals. Specifically:</p>
<ul>
<li>Where multiple databases (or tables) need to be combined before they offer any meaningful value.
<ul>
<li>For example, connecting the expense report system to the company’s travel agency to match flights and hotels may help validate that travel policies are adhered to.</li>
</ul></li>
<li>Information that needs to be rapidly presented and consumed for an ongoing report.
<ul>
<li>For example, an audit KPI monitoring new risks within a Continuous Monitoring program may be prepared in advance, due to the complexity of calculations needed over a period of time.</li>
</ul></li>
<li>Data that is considered ‘master’ or ‘reference’.
<ul>
<li>A listing of account names and numbers may be useful to have on hand as it is relevant to any audit.</li>
<li>In contrast, a list of transactions may only be needed for a single audit inquiry.</li>
</ul></li>
</ul>
<p>You can use any database that your company provides. It will be important that you have the ability to create tables within this database, delete them, and ensure you can work with someone who can administer the security to prevent non-audit users from querying the database.</p>
</div>
<div id="etl-essentials" class="section level2">
<h2><span class="header-section-number">14.2</span> ETL Essentials</h2>
<p>In the <a href="architecture.html#architecture-rsc">Architecture chapter</a>, we referenced using RStudio Connect to facilitate the process to extract, transform and load (ETL). RStudio Connect relies on R Markdown notebooks to execute analytic processes, which we can design and prepare locally before scheduling.</p>
<p>The audit team will likely be maintaining this audit data mart - therefore, some additional considerations need to be thought about:</p>
<ol style="list-style-type: decimal">
<li>While R Markdown notebooks are self documenting, having well outlined documentation that explains where the data came from, how it was transformed and where it ends up being will be useful to your teammates and future self.</li>
<li><a href="other-practices-to-follow.html#passwords">Secure your credentials</a>. Do not place them directly in the notebook as plain text. If using RStudio Connect, call passwords via an environment variable.</li>
<li>Ensure proper checks are in place. Actively scan for data structure anomalies and catch them before they get uploaded, and ensuring that data that was downloaded is fresh by examining dates.</li>
<li>Where possible, avoid overwriting a table completely each time by replacing it with the fresh information that was just extracted. While in some situations this is reasonable, the trade-off between simpler design and the speed of the ETL will become more glaring as the dataset grows.</li>
</ol>
</div>
<div id="etl-example" class="section level2">
<h2><span class="header-section-number">14.3</span> ETL Example</h2>
<p>Below is an example of what may be contained in an ETL notebook.</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb433-1"><a href="applied-datamart.html#cb433-1"></a>---</span>
<span id="cb433-2"><a href="applied-datamart.html#cb433-2"></a>title: &quot;Audit Data Mart - ETL 111 HR&quot;</span>
<span id="cb433-3"><a href="applied-datamart.html#cb433-3"></a>author: &quot;Your name&quot;</span>
<span id="cb433-4"><a href="applied-datamart.html#cb433-4"></a>date: &quot;2020-11-11 23:45:04&quot;</span>
<span id="cb433-5"><a href="applied-datamart.html#cb433-5"></a>output:</span>
<span id="cb433-6"><a href="applied-datamart.html#cb433-6"></a>  html_document</span>
<span id="cb433-7"><a href="applied-datamart.html#cb433-7"></a>---</span>
<span id="cb433-8"><a href="applied-datamart.html#cb433-8"></a></span>
<span id="cb433-9"><a href="applied-datamart.html#cb433-9"></a><span class="fu"># Credentials</span></span>
<span id="cb433-10"><a href="applied-datamart.html#cb433-10"></a></span>
<span id="cb433-11"><a href="applied-datamart.html#cb433-11"></a><span class="bn">```{r}</span></span>
<span id="cb433-12"><a href="applied-datamart.html#cb433-12"></a><span class="bn">passwords &lt;- Sys.getenv(&quot;dbpassword&quot;)</span></span>
<span id="cb433-13"><a href="applied-datamart.html#cb433-13"></a><span class="bn">```</span></span>
<span id="cb433-14"><a href="applied-datamart.html#cb433-14"></a></span>
<span id="cb433-15"><a href="applied-datamart.html#cb433-15"></a><span class="fu"># Extract</span></span>
<span id="cb433-16"><a href="applied-datamart.html#cb433-16"></a></span>
<span id="cb433-17"><a href="applied-datamart.html#cb433-17"></a><span class="bn">```{r}</span></span>
<span id="cb433-18"><a href="applied-datamart.html#cb433-18"></a><span class="bn">con &lt;- connect_hr(passwords)</span></span>
<span id="cb433-19"><a href="applied-datamart.html#cb433-19"></a><span class="bn">employee_list &lt;- get_hr_employees(con)</span></span>
<span id="cb433-20"><a href="applied-datamart.html#cb433-20"></a><span class="bn">reporting_structure &lt;- get_hr_reporting(con)</span></span>
<span id="cb433-21"><a href="applied-datamart.html#cb433-21"></a><span class="bn">```</span></span>
<span id="cb433-22"><a href="applied-datamart.html#cb433-22"></a></span>
<span id="cb433-23"><a href="applied-datamart.html#cb433-23"></a><span class="fu"># Extract check</span></span>
<span id="cb433-24"><a href="applied-datamart.html#cb433-24"></a></span>
<span id="cb433-25"><a href="applied-datamart.html#cb433-25"></a>Check on the latest termination date. Usually we have a termination every week.</span>
<span id="cb433-26"><a href="applied-datamart.html#cb433-26"></a></span>
<span id="cb433-27"><a href="applied-datamart.html#cb433-27"></a><span class="bn">```{r}</span></span>
<span id="cb433-28"><a href="applied-datamart.html#cb433-28"></a><span class="bn">days_since_last_term &lt;- Sys.date - max(employee_list$term_date) </span></span>
<span id="cb433-29"><a href="applied-datamart.html#cb433-29"></a><span class="bn">if (days_since_last_term &gt; 14) {stop(&quot;Danger!&quot;)}</span></span>
<span id="cb433-30"><a href="applied-datamart.html#cb433-30"></a><span class="bn">```</span></span>
<span id="cb433-31"><a href="applied-datamart.html#cb433-31"></a></span>
<span id="cb433-32"><a href="applied-datamart.html#cb433-32"></a><span class="fu"># Extract summary</span></span>
<span id="cb433-33"><a href="applied-datamart.html#cb433-33"></a></span>
<span id="cb433-34"><a href="applied-datamart.html#cb433-34"></a><span class="bn">```{r}</span></span>
<span id="cb433-35"><a href="applied-datamart.html#cb433-35"></a><span class="bn">nrow(employee_list)</span></span>
<span id="cb433-36"><a href="applied-datamart.html#cb433-36"></a><span class="bn">nrow(reporting_structure)</span></span>
<span id="cb433-37"><a href="applied-datamart.html#cb433-37"></a><span class="bn">```</span></span>
<span id="cb433-38"><a href="applied-datamart.html#cb433-38"></a></span>
<span id="cb433-39"><a href="applied-datamart.html#cb433-39"></a><span class="fu"># Transform</span></span>
<span id="cb433-40"><a href="applied-datamart.html#cb433-40"></a></span>
<span id="cb433-41"><a href="applied-datamart.html#cb433-41"></a><span class="bn">```{r}</span></span>
<span id="cb433-42"><a href="applied-datamart.html#cb433-42"></a><span class="bn">cleaned_staff &lt;- employee_list %&gt;%</span></span>
<span id="cb433-43"><a href="applied-datamart.html#cb433-43"></a><span class="bn">  left_join(reporting_structure, by = &#39;employee_id&#39;) %&gt;% # Gets the ID number of the supervisor of the employee</span></span>
<span id="cb433-44"><a href="applied-datamart.html#cb433-44"></a><span class="bn">  left_join(employee_list, by = &#39;supervisor_id&#39;) # Gets the name of the supervisor</span></span>
<span id="cb433-45"><a href="applied-datamart.html#cb433-45"></a><span class="bn">```</span></span>
<span id="cb433-46"><a href="applied-datamart.html#cb433-46"></a></span>
<span id="cb433-47"><a href="applied-datamart.html#cb433-47"></a><span class="fu"># Transform check</span></span>
<span id="cb433-48"><a href="applied-datamart.html#cb433-48"></a></span>
<span id="cb433-49"><a href="applied-datamart.html#cb433-49"></a>Check that every employee has a boss</span>
<span id="cb433-50"><a href="applied-datamart.html#cb433-50"></a></span>
<span id="cb433-51"><a href="applied-datamart.html#cb433-51"></a><span class="bn">```{r}</span></span>
<span id="cb433-52"><a href="applied-datamart.html#cb433-52"></a><span class="bn">no_boss &lt;- cleaned_staff %&gt;%</span></span>
<span id="cb433-53"><a href="applied-datamart.html#cb433-53"></a><span class="bn">  filter(is.na(supervisor_id))</span></span>
<span id="cb433-54"><a href="applied-datamart.html#cb433-54"></a><span class="bn">  </span></span>
<span id="cb433-55"><a href="applied-datamart.html#cb433-55"></a><span class="bn">if (nrow(no_boss) &gt; 0) {stop(&quot;Danger!&quot;)}</span></span>
<span id="cb433-56"><a href="applied-datamart.html#cb433-56"></a><span class="bn">```</span></span>
<span id="cb433-57"><a href="applied-datamart.html#cb433-57"></a></span>
<span id="cb433-58"><a href="applied-datamart.html#cb433-58"></a><span class="fu"># Transform summary</span></span>
<span id="cb433-59"><a href="applied-datamart.html#cb433-59"></a></span>
<span id="cb433-60"><a href="applied-datamart.html#cb433-60"></a><span class="bn">```{r}</span></span>
<span id="cb433-61"><a href="applied-datamart.html#cb433-61"></a><span class="bn">nrow(cleaned_staff)</span></span>
<span id="cb433-62"><a href="applied-datamart.html#cb433-62"></a><span class="bn">```</span></span>
<span id="cb433-63"><a href="applied-datamart.html#cb433-63"></a></span>
<span id="cb433-64"><a href="applied-datamart.html#cb433-64"></a><span class="fu"># Load </span></span>
<span id="cb433-65"><a href="applied-datamart.html#cb433-65"></a></span>
<span id="cb433-66"><a href="applied-datamart.html#cb433-66"></a><span class="bn">```{r}</span></span>
<span id="cb433-67"><a href="applied-datamart.html#cb433-67"></a><span class="bn">con &lt;- connect_audit_data_mart(passwords)</span></span>
<span id="cb433-68"><a href="applied-datamart.html#cb433-68"></a></span>
<span id="cb433-69"><a href="applied-datamart.html#cb433-69"></a><span class="bn">dbWriteTable(con, &#39;staff_table&#39;, cleaned_staff, overwrite = TRUE)</span></span>
<span id="cb433-70"><a href="applied-datamart.html#cb433-70"></a><span class="bn">```</span></span>
<span id="cb433-71"><a href="applied-datamart.html#cb433-71"></a></span>
<span id="cb433-72"><a href="applied-datamart.html#cb433-72"></a><span class="fu"># Load check</span></span>
<span id="cb433-73"><a href="applied-datamart.html#cb433-73"></a></span>
<span id="cb433-74"><a href="applied-datamart.html#cb433-74"></a>Check that our new table matches the ETL table we just created</span>
<span id="cb433-75"><a href="applied-datamart.html#cb433-75"></a></span>
<span id="cb433-76"><a href="applied-datamart.html#cb433-76"></a><span class="bn">```{r}</span></span>
<span id="cb433-77"><a href="applied-datamart.html#cb433-77"></a><span class="bn">new_count &lt;- dbReadTable(con, &#39;cleaned_staff&#39;)</span></span>
<span id="cb433-78"><a href="applied-datamart.html#cb433-78"></a><span class="bn">nrow(new_count)</span></span>
<span id="cb433-79"><a href="applied-datamart.html#cb433-79"></a></span>
<span id="cb433-80"><a href="applied-datamart.html#cb433-80"></a><span class="bn">if (nrow(new_count) != nrow(cleaned_staff)) {stop(&quot;Danger!&quot;)}</span></span>
<span id="cb433-81"><a href="applied-datamart.html#cb433-81"></a><span class="bn">```</span></span>
<span id="cb433-82"><a href="applied-datamart.html#cb433-82"></a></span>
<span id="cb433-83"><a href="applied-datamart.html#cb433-83"></a><span class="fu"># Session Info</span></span>
<span id="cb433-84"><a href="applied-datamart.html#cb433-84"></a><span class="bn">```{r}</span></span>
<span id="cb433-85"><a href="applied-datamart.html#cb433-85"></a><span class="bn">sessionInfo()</span></span>
<span id="cb433-86"><a href="applied-datamart.html#cb433-86"></a><span class="bn">```</span></span></code></pre></div>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="continuous-monitoring.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendix-ca.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Audit_Analytics_with-R.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
